<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "3ba7150ffc4a6999f6c3cfb4906ec7df",
  "translation_date": "2025-08-24T21:33:33+00:00",
  "source_file": "4-manufacturing/lessons/2-check-fruit-from-device/virtual-device-camera.md",
  "language_code": "zh"
}
-->
# æ•è·å›¾åƒ - è™šæ‹Ÿç‰©è”ç½‘ç¡¬ä»¶

åœ¨æœ¬è¯¾ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ï¼Œæ‚¨å°†ä¸ºè™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡æ·»åŠ ä¸€ä¸ªæ‘„åƒå¤´ä¼ æ„Ÿå™¨ï¼Œå¹¶ä»ä¸­è¯»å–å›¾åƒã€‚

## ç¡¬ä»¶

è™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡å°†ä½¿ç”¨ä¸€ä¸ªæ¨¡æ‹Ÿæ‘„åƒå¤´ï¼Œè¯¥æ‘„åƒå¤´å¯ä»¥å‘é€æ–‡ä»¶ä¸­çš„å›¾åƒæˆ–æ¥è‡ªæ‚¨çš„ç½‘ç»œæ‘„åƒå¤´çš„å›¾åƒã€‚

### å°†æ‘„åƒå¤´æ·»åŠ åˆ° CounterFit

è¦ä½¿ç”¨è™šæ‹Ÿæ‘„åƒå¤´ï¼Œæ‚¨éœ€è¦å°†å…¶æ·»åŠ åˆ° CounterFit åº”ç”¨ç¨‹åºä¸­ã€‚

#### ä»»åŠ¡ - å°†æ‘„åƒå¤´æ·»åŠ åˆ° CounterFit

å°†æ‘„åƒå¤´æ·»åŠ åˆ° CounterFit åº”ç”¨ç¨‹åºã€‚

1. åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º `fruit-quality-detector` çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º `app.py` çš„å•ä¸€æ–‡ä»¶å’Œä¸€ä¸ª Python è™šæ‹Ÿç¯å¢ƒï¼Œç„¶åæ·»åŠ  CounterFit çš„ pip åŒ…ã€‚

    > âš ï¸ å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥å‚è€ƒ[ç¬¬ 1 è¯¾ä¸­åˆ›å»ºå’Œè®¾ç½® CounterFit Python é¡¹ç›®çš„è¯´æ˜](../../../1-getting-started/lessons/1-introduction-to-iot/virtual-device.md)ã€‚

1. å®‰è£…ä¸€ä¸ªé¢å¤–çš„ Pip åŒ…ï¼Œç”¨äºå®‰è£…ä¸€ä¸ª CounterFit shimï¼Œå®ƒå¯ä»¥é€šè¿‡æ¨¡æ‹Ÿéƒ¨åˆ† [Picamera Pip åŒ…](https://pypi.org/project/picamera/) æ¥ä¸æ‘„åƒå¤´ä¼ æ„Ÿå™¨é€šä¿¡ã€‚ç¡®ä¿æ‚¨æ˜¯åœ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒçš„ç»ˆç«¯ä¸­å®‰è£…æ­¤åŒ…ã€‚

    ```sh
    pip install counterfit-shims-picamera
    ```

1. ç¡®ä¿ CounterFit ç½‘é¡µåº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œã€‚

1. åˆ›å»ºä¸€ä¸ªæ‘„åƒå¤´ï¼š

    1. åœ¨ *Sensors* é¢æ¿çš„ *Create sensor* æ¡†ä¸­ï¼Œç‚¹å‡» *Sensor type* ä¸‹æ‹‰æ¡†å¹¶é€‰æ‹© *Camera*ã€‚

    1. å°† *Name* è®¾ç½®ä¸º `Picamera`ã€‚

    1. é€‰æ‹© **Add** æŒ‰é’®ä»¥åˆ›å»ºæ‘„åƒå¤´ã€‚

    ![æ‘„åƒå¤´è®¾ç½®](../../../../translated_images/counterfit-create-camera.a5de97f59c0bd3cbe0416d7e89a3cfe86d19fbae05c641c53a91286412af0a34.zh.png)

    æ‘„åƒå¤´å°†è¢«åˆ›å»ºå¹¶æ˜¾ç¤ºåœ¨ä¼ æ„Ÿå™¨åˆ—è¡¨ä¸­ã€‚

    ![æ‘„åƒå¤´å·²åˆ›å»º](../../../../translated_images/counterfit-camera.001ec52194c8ee5d3f617173da2c79e1df903d10882adc625cbfc493525125d4.zh.png)

## ç¼–ç¨‹æ‘„åƒå¤´

ç°åœ¨å¯ä»¥ä¸ºè™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡ç¼–ç¨‹ä»¥ä½¿ç”¨è™šæ‹Ÿæ‘„åƒå¤´ã€‚

### ä»»åŠ¡ - ç¼–ç¨‹æ‘„åƒå¤´

ä¸ºè®¾å¤‡ç¼–ç¨‹ã€‚

1. ç¡®ä¿ `fruit-quality-detector` åº”ç”¨ç¨‹åºå·²åœ¨ VS Code ä¸­æ‰“å¼€ã€‚

1. æ‰“å¼€ `app.py` æ–‡ä»¶ã€‚

1. åœ¨ `app.py` æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹ä»£ç ä»¥è¿æ¥åº”ç”¨ç¨‹åºåˆ° CounterFitï¼š

    ```python
    from counterfit_connection import CounterFitConnection
    CounterFitConnection.init('127.0.0.1', 5000)
    ```

1. åœ¨æ‚¨çš„ `app.py` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

    ```python
    import io
    from counterfit_shims_picamera import PiCamera
    ```

    æ­¤ä»£ç å¯¼å…¥äº†ä¸€äº›æ‰€éœ€çš„åº“ï¼ŒåŒ…æ‹¬æ¥è‡ª counterfit_shims_picamera åº“çš„ `PiCamera` ç±»ã€‚

1. åœ¨æ­¤ä»£ç ä¸‹æ–¹æ·»åŠ ä»¥ä¸‹ä»£ç ä»¥åˆå§‹åŒ–æ‘„åƒå¤´ï¼š

    ```python
    camera = PiCamera()
    camera.resolution = (640, 480)
    camera.rotation = 0
    ```

    æ­¤ä»£ç åˆ›å»ºäº†ä¸€ä¸ª PiCamera å¯¹è±¡ï¼Œå¹¶å°†åˆ†è¾¨ç‡è®¾ç½®ä¸º 640x480ã€‚è™½ç„¶æ”¯æŒæ›´é«˜çš„åˆ†è¾¨ç‡ï¼Œä½†å›¾åƒåˆ†ç±»å™¨å¤„ç†çš„å›¾åƒå°ºå¯¸è¾ƒå°ï¼ˆ227x227ï¼‰ï¼Œå› æ­¤æ— éœ€æ•è·å’Œå‘é€æ›´å¤§çš„å›¾åƒã€‚

    `camera.rotation = 0` è¡Œè®¾ç½®å›¾åƒçš„æ—‹è½¬è§’åº¦ï¼ˆä»¥åº¦ä¸ºå•ä½ï¼‰ã€‚å¦‚æœéœ€è¦æ—‹è½¬æ¥è‡ªç½‘ç»œæ‘„åƒå¤´æˆ–æ–‡ä»¶çš„å›¾åƒï¼Œè¯·æ ¹æ®éœ€è¦è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³å°†ç½‘ç»œæ‘„åƒå¤´ä¸­æ¨ªå‘æ¨¡å¼çš„é¦™è•‰å›¾åƒæ›´æ”¹ä¸ºçºµå‘æ¨¡å¼ï¼Œè¯·è®¾ç½® `camera.rotation = 90`ã€‚

1. åœ¨æ­¤ä»£ç ä¸‹æ–¹æ·»åŠ ä»¥ä¸‹ä»£ç ä»¥å°†å›¾åƒæ•è·ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼š

    ```python
    image = io.BytesIO()
    camera.capture(image, 'jpeg')
    image.seek(0)
    ```

    æ­¤ä»£ç åˆ›å»ºäº†ä¸€ä¸ª `BytesIO` å¯¹è±¡æ¥å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ã€‚å›¾åƒä»¥ JPEG æ–‡ä»¶çš„å½¢å¼ä»æ‘„åƒå¤´è¯»å–å¹¶å­˜å‚¨åœ¨æ­¤å¯¹è±¡ä¸­ã€‚æ­¤å¯¹è±¡æœ‰ä¸€ä¸ªä½ç½®æŒ‡ç¤ºå™¨ï¼Œç”¨äºæŒ‡ç¤ºæ•°æ®çš„å½“å‰ä½ç½®ï¼Œä»¥ä¾¿å¯ä»¥åœ¨éœ€è¦æ—¶å°†æ›´å¤šæ•°æ®å†™å…¥æœ«å°¾ï¼Œå› æ­¤ `image.seek(0)` è¡Œå°†æ­¤ä½ç½®ç§»å›èµ·å§‹ä½ç½®ï¼Œä»¥ä¾¿ç¨åå¯ä»¥è¯»å–æ‰€æœ‰æ•°æ®ã€‚

1. åœ¨æ­¤ä»£ç ä¸‹æ–¹æ·»åŠ ä»¥ä¸‹ä»£ç ä»¥å°†å›¾åƒä¿å­˜åˆ°æ–‡ä»¶ï¼š

    ```python
    with open('image.jpg', 'wb') as image_file:
        image_file.write(image.read())
    ```

    æ­¤ä»£ç æ‰“å¼€ä¸€ä¸ªåä¸º `image.jpg` çš„æ–‡ä»¶è¿›è¡Œå†™å…¥ï¼Œç„¶åä» `BytesIO` å¯¹è±¡ä¸­è¯»å–æ‰€æœ‰æ•°æ®å¹¶å†™å…¥è¯¥æ–‡ä»¶ã€‚

    > ğŸ’ æ‚¨å¯ä»¥ç›´æ¥å°†å›¾åƒæ•è·åˆ°æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `BytesIO` å¯¹è±¡ï¼Œåªéœ€å°†æ–‡ä»¶åä¼ é€’ç»™ `camera.capture` è°ƒç”¨å³å¯ã€‚ä½¿ç”¨ `BytesIO` å¯¹è±¡çš„åŸå› æ˜¯ç¨ååœ¨æœ¬è¯¾ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥å°†å›¾åƒå‘é€åˆ°æ‚¨çš„å›¾åƒåˆ†ç±»å™¨ã€‚

1. é…ç½® CounterFit ä¸­æ‘„åƒå¤´å°†æ•è·çš„å›¾åƒã€‚æ‚¨å¯ä»¥å°† *Source* è®¾ç½®ä¸º *File*ï¼Œç„¶åä¸Šä¼ ä¸€ä¸ªå›¾åƒæ–‡ä»¶ï¼Œæˆ–è€…å°† *Source* è®¾ç½®ä¸º *WebCam*ï¼Œå›¾åƒå°†ä»æ‚¨çš„ç½‘ç»œæ‘„åƒå¤´æ•è·ã€‚ç¡®ä¿åœ¨é€‰æ‹©å›¾ç‰‡æˆ–ç½‘ç»œæ‘„åƒå¤´åç‚¹å‡» **Set** æŒ‰é’®ã€‚

    ![CounterFit ä¸­è®¾ç½®ä¸ºæ–‡ä»¶çš„å›¾åƒæºï¼Œä»¥åŠè®¾ç½®ä¸ºç½‘ç»œæ‘„åƒå¤´æ˜¾ç¤ºä¸€ä¸ªäººæ‰‹æŒé¦™è•‰çš„é¢„è§ˆ](../../../../translated_images/counterfit-camera-options.eb3bd5150a8e7dffbf24bc5bcaba0cf2cdef95fbe6bbe393695d173817d6b8df.zh.png)

1. å›¾åƒå°†è¢«æ•è·å¹¶ä¿å­˜ä¸ºå½“å‰æ–‡ä»¶å¤¹ä¸­çš„ `image.jpg`ã€‚æ‚¨å°†åœ¨ VS Code çš„èµ„æºç®¡ç†å™¨ä¸­çœ‹åˆ°æ­¤æ–‡ä»¶ã€‚é€‰æ‹©è¯¥æ–‡ä»¶ä»¥æŸ¥çœ‹å›¾åƒã€‚å¦‚æœéœ€è¦æ—‹è½¬ï¼Œè¯·æ ¹æ®éœ€è¦æ›´æ–° `camera.rotation = 0` è¡Œå¹¶é‡æ–°æ‹æ‘„å›¾ç‰‡ã€‚

> ğŸ’ æ‚¨å¯ä»¥åœ¨ [code-camera/virtual-iot-device](../../../../../4-manufacturing/lessons/2-check-fruit-from-device/code-camera/virtual-iot-device) æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°æ­¤ä»£ç ã€‚

ğŸ˜€ æ‚¨çš„æ‘„åƒå¤´ç¨‹åºè¿è¡ŒæˆåŠŸï¼
