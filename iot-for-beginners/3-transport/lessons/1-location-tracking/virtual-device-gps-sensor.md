<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "64f18a8f8aaa1fef5e7320e0992d8b3a",
  "translation_date": "2025-08-25T00:45:25+00:00",
  "source_file": "3-transport/lessons/1-location-tracking/virtual-device-gps-sensor.md",
  "language_code": "zh"
}
-->
# è¯»å– GPS æ•°æ® - è™šæ‹Ÿç‰©è”ç½‘ç¡¬ä»¶

åœ¨æœ¬è¯¾ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ï¼Œä½ å°†ä¸ºè™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡æ·»åŠ ä¸€ä¸ª GPS ä¼ æ„Ÿå™¨ï¼Œå¹¶ä»ä¸­è¯»å–æ•°æ®ã€‚

## è™šæ‹Ÿç¡¬ä»¶

è™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡å°†ä½¿ç”¨ä¸€ä¸ªé€šè¿‡ä¸²å£ UART è®¿é—®çš„æ¨¡æ‹Ÿ GPS ä¼ æ„Ÿå™¨ã€‚

ç‰©ç† GPS ä¼ æ„Ÿå™¨é€šå¸¸é…å¤‡å¤©çº¿ï¼Œç”¨äºæ¥æ”¶æ¥è‡ª GPS å«æ˜Ÿçš„æ— çº¿ç”µæ³¢ï¼Œå¹¶å°† GPS ä¿¡å·è½¬æ¢ä¸º GPS æ•°æ®ã€‚è™šæ‹Ÿç‰ˆæœ¬é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ¨¡æ‹Ÿï¼šä½ å¯ä»¥è®¾ç½®çº¬åº¦å’Œç»åº¦ã€å‘é€åŸå§‹ NMEA è¯­å¥ï¼Œæˆ–è€…ä¸Šä¼ åŒ…å«å¤šä¸ªä½ç½®çš„ GPX æ–‡ä»¶ï¼Œè¿™äº›ä½ç½®å°†æŒ‰é¡ºåºè¿”å›ã€‚

> ğŸ“ NMEA è¯­å¥å°†åœ¨æœ¬è¯¾ç¨‹åç»­éƒ¨åˆ†ä»‹ç»

### å°†ä¼ æ„Ÿå™¨æ·»åŠ åˆ° CounterFit

è¦ä½¿ç”¨è™šæ‹Ÿ GPS ä¼ æ„Ÿå™¨ï¼Œä½ éœ€è¦å°†å…¶æ·»åŠ åˆ° CounterFit åº”ç”¨ä¸­ã€‚

#### ä»»åŠ¡ - å°†ä¼ æ„Ÿå™¨æ·»åŠ åˆ° CounterFit

å°† GPS ä¼ æ„Ÿå™¨æ·»åŠ åˆ° CounterFit åº”ç”¨ã€‚

1. åœ¨ä½ çš„ç”µè„‘ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º `gps-sensor` çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ Python åº”ç”¨ï¼ŒåŒ…å«ä¸€ä¸ªåä¸º `app.py` çš„æ–‡ä»¶å’Œä¸€ä¸ª Python è™šæ‹Ÿç¯å¢ƒï¼Œç„¶åæ·»åŠ  CounterFit çš„ pip åŒ…ã€‚

    > âš ï¸ å¦‚æœéœ€è¦ï¼Œå¯ä»¥å‚è€ƒ[è¯¾ç¨‹ 1 ä¸­å…³äºåˆ›å»ºå’Œè®¾ç½® CounterFit Python é¡¹ç›®çš„è¯´æ˜](../../../1-getting-started/lessons/1-introduction-to-iot/virtual-device.md)ã€‚

1. å®‰è£…ä¸€ä¸ªé¢å¤–çš„ Pip åŒ…ï¼Œç”¨äºå®‰è£…ä¸€ä¸ª CounterFit shimï¼Œå¯ä»¥é€šè¿‡ä¸²å£ä¸åŸºäº UART çš„ä¼ æ„Ÿå™¨é€šä¿¡ã€‚ç¡®ä¿åœ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒçš„ç»ˆç«¯ä¸­å®‰è£…æ­¤åŒ…ã€‚

    ```sh
    pip install counterfit-shims-serial
    ```

1. ç¡®ä¿ CounterFit ç½‘é¡µåº”ç”¨æ­£åœ¨è¿è¡Œã€‚

1. åˆ›å»ºä¸€ä¸ª GPS ä¼ æ„Ÿå™¨ï¼š

    1. åœ¨ *Sensors* é¢æ¿çš„ *Create sensor* æ¡†ä¸­ï¼Œç‚¹å‡» *Sensor type* ä¸‹æ‹‰æ¡†å¹¶é€‰æ‹© *UART GPS*ã€‚

    1. å°† *Port* ä¿æŒä¸º */dev/ttyAMA0*ã€‚

    1. ç‚¹å‡» **Add** æŒ‰é’®ï¼Œåœ¨ç«¯å£ `/dev/ttyAMA0` ä¸Šåˆ›å»º GPS ä¼ æ„Ÿå™¨ã€‚

    ![GPS ä¼ æ„Ÿå™¨è®¾ç½®](../../../../translated_images/counterfit-create-gps-sensor.6385dc9357d85ad1d47b4abb2525e7651fd498917d25eefc5a72feab09eedc70.zh.png)

    GPS ä¼ æ„Ÿå™¨å°†è¢«åˆ›å»ºå¹¶æ˜¾ç¤ºåœ¨ä¼ æ„Ÿå™¨åˆ—è¡¨ä¸­ã€‚

    ![å·²åˆ›å»ºçš„ GPS ä¼ æ„Ÿå™¨](../../../../translated_images/counterfit-gps-sensor.3fbb15af0a5367566f2f11324ef5a6f30861cdf2b497071a5e002b7aa473550e.zh.png)

## ç¼–ç¨‹ GPS ä¼ æ„Ÿå™¨

ç°åœ¨å¯ä»¥ä¸ºè™šæ‹Ÿç‰©è”ç½‘è®¾å¤‡ç¼–ç¨‹ä»¥ä½¿ç”¨è™šæ‹Ÿ GPS ä¼ æ„Ÿå™¨ã€‚

### ä»»åŠ¡ - ç¼–ç¨‹ GPS ä¼ æ„Ÿå™¨

ç¼–å†™ GPS ä¼ æ„Ÿå™¨åº”ç”¨ç¨‹åºã€‚

1. ç¡®ä¿ `gps-sensor` åº”ç”¨å·²åœ¨ VS Code ä¸­æ‰“å¼€ã€‚

1. æ‰“å¼€ `app.py` æ–‡ä»¶ã€‚

1. åœ¨ `app.py` æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œå°†åº”ç”¨è¿æ¥åˆ° CounterFitï¼š

    ```python
    from counterfit_connection import CounterFitConnection
    CounterFitConnection.init('127.0.0.1', 5000)
    ```

1. åœ¨æ­¤ä»£ç ä¸‹æ–¹æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œå¯¼å…¥ä¸€äº›æ‰€éœ€çš„åº“ï¼ŒåŒ…æ‹¬ç”¨äº CounterFit ä¸²å£çš„åº“ï¼š

    ```python
    import time
    import counterfit_shims_serial
    
    serial = counterfit_shims_serial.Serial('/dev/ttyAMA0')
    ```

    æ­¤ä»£ç ä» `counterfit_shims_serial` Pip åŒ…ä¸­å¯¼å…¥ `serial` æ¨¡å—ã€‚ç„¶åè¿æ¥åˆ° `/dev/ttyAMA0` ä¸²å£â€”â€”è¿™æ˜¯è™šæ‹Ÿ GPS ä¼ æ„Ÿå™¨ç”¨äºå…¶ UART ç«¯å£çš„åœ°å€ã€‚

1. åœ¨æ­¤ä»£ç ä¸‹æ–¹æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œä»ä¸²å£è¯»å–æ•°æ®å¹¶å°†å€¼æ‰“å°åˆ°æ§åˆ¶å°ï¼š

    ```python
    def print_gps_data(line):
        print(line.rstrip())
    
    while True:
        line = serial.readline().decode('utf-8')
    
        while len(line) > 0:
            print_gps_data(line)
            line = serial.readline().decode('utf-8')
    
        time.sleep(1)
    ```

    å®šä¹‰äº†ä¸€ä¸ªåä¸º `print_gps_data` çš„å‡½æ•°ï¼Œç”¨äºå°†ä¼ å…¥çš„è¡Œæ‰“å°åˆ°æ§åˆ¶å°ã€‚

    æ¥ä¸‹æ¥ï¼Œä»£ç è¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œåœ¨æ¯æ¬¡å¾ªç¯ä¸­å°½å¯èƒ½å¤šåœ°ä»ä¸²å£è¯»å–æ–‡æœ¬è¡Œã€‚å®ƒä¸ºæ¯ä¸€è¡Œè°ƒç”¨ `print_gps_data` å‡½æ•°ã€‚

    è¯»å–å®Œæ‰€æœ‰æ•°æ®åï¼Œå¾ªç¯ä¼šä¼‘çœ  1 ç§’ï¼Œç„¶åå†æ¬¡å°è¯•ã€‚

1. è¿è¡Œæ­¤ä»£ç ï¼Œç¡®ä¿ä½¿ç”¨ä¸è¿è¡Œ CounterFit åº”ç”¨ä¸åŒçš„ç»ˆç«¯ï¼Œä»¥ä¾¿ CounterFit åº”ç”¨ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚

1. åœ¨ CounterFit åº”ç”¨ä¸­æ›´æ”¹ GPS ä¼ æ„Ÿå™¨çš„å€¼ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€è¿›è¡Œæ›´æ”¹ï¼š

    * å°† **Source** è®¾ç½®ä¸º `Lat/Lon`ï¼Œå¹¶è®¾ç½®æ˜ç¡®çš„çº¬åº¦ã€ç»åº¦ä»¥åŠç”¨äºè·å– GPS å®šä½çš„å«æ˜Ÿæ•°é‡ã€‚æ­¤å€¼å°†ä»…å‘é€ä¸€æ¬¡ï¼Œå› æ­¤å‹¾é€‰ **Repeat** å¤é€‰æ¡†ä»¥ä½¿æ•°æ®æ¯ç§’é‡å¤å‘é€ã€‚

      ![é€‰æ‹©çº¬åº¦å’Œç»åº¦çš„ GPS ä¼ æ„Ÿå™¨](../../../../translated_images/counterfit-gps-sensor-latlon.008c867d75464fbe7f84107cc57040df565ac07cb57d2f21db37d087d470197d.zh.png)

    * å°† **Source** è®¾ç½®ä¸º `NMEA`ï¼Œå¹¶åœ¨æ–‡æœ¬æ¡†ä¸­æ·»åŠ ä¸€äº› NMEA è¯­å¥ã€‚æ‰€æœ‰è¿™äº›å€¼å°†è¢«å‘é€ï¼Œæ¯ä¸ªæ–°çš„ GGAï¼ˆä½ç½®å›ºå®šï¼‰è¯­å¥ä¹‹é—´æœ‰ 1 ç§’çš„å»¶è¿Ÿã€‚

      ![è®¾ç½® NMEA è¯­å¥çš„ GPS ä¼ æ„Ÿå™¨](../../../../translated_images/counterfit-gps-sensor-nmea.c62eea442171e17e19528b051b104cfcecdc9cd18db7bc72920f29821ae63f73.zh.png)

      ä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼ [nmeagen.org](https://www.nmeagen.org) çš„å·¥å…·é€šè¿‡åœ¨åœ°å›¾ä¸Šç»˜åˆ¶æ¥ç”Ÿæˆè¿™äº›è¯­å¥ã€‚è¿™äº›å€¼å°†ä»…å‘é€ä¸€æ¬¡ï¼Œå› æ­¤å‹¾é€‰ **Repeat** å¤é€‰æ¡†ä»¥ä½¿æ•°æ®åœ¨å…¨éƒ¨å‘é€åæ¯ç§’é‡å¤ä¸€æ¬¡ã€‚

    * å°† **Source** è®¾ç½®ä¸º GPX æ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ ä¸€ä¸ªåŒ…å«è½¨è¿¹ä½ç½®çš„ GPX æ–‡ä»¶ã€‚ä½ å¯ä»¥ä»è®¸å¤šæµè¡Œçš„åœ°å›¾å’Œå¾’æ­¥ç½‘ç«™ï¼ˆå¦‚ [AllTrails](https://www.alltrails.com/)ï¼‰ä¸‹è½½ GPX æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶åŒ…å«å¤šä¸ª GPS ä½ç½®ä½œä¸ºè½¨è¿¹ï¼ŒGPS ä¼ æ„Ÿå™¨å°†ä»¥ 1 ç§’é—´éš”è¿”å›æ¯ä¸ªæ–°ä½ç½®ã€‚

      ![è®¾ç½® GPX æ–‡ä»¶çš„ GPS ä¼ æ„Ÿå™¨](../../../../translated_images/counterfit-gps-sensor-gpxfile.8310b063ce8a425ccc8ebeec8306aeac5e8e55207f007d52c6e1194432a70cd9.zh.png)

      è¿™äº›å€¼å°†ä»…å‘é€ä¸€æ¬¡ï¼Œå› æ­¤å‹¾é€‰ **Repeat** å¤é€‰æ¡†ä»¥ä½¿æ•°æ®åœ¨å…¨éƒ¨å‘é€åæ¯ç§’é‡å¤ä¸€æ¬¡ã€‚

    é…ç½® GPS è®¾ç½®åï¼Œç‚¹å‡» **Set** æŒ‰é’®å°†è¿™äº›å€¼æäº¤åˆ°ä¼ æ„Ÿå™¨ã€‚

1. ä½ å°†çœ‹åˆ°æ¥è‡ª GPS ä¼ æ„Ÿå™¨çš„åŸå§‹è¾“å‡ºï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š

    ```text
    $GNGGA,020604.001,4738.538654,N,12208.341758,W,1,3,,164.7,M,-17.1,M,,*67
    $GNGGA,020604.001,4738.538654,N,12208.341758,W,1,3,,164.7,M,-17.1,M,,*67
    ```

> ğŸ’ ä½ å¯ä»¥åœ¨ [code-gps/virtual-device](../../../../../3-transport/lessons/1-location-tracking/code-gps/virtual-device) æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°æ­¤ä»£ç ã€‚

ğŸ˜€ æ­å–œï¼ä½ çš„ GPS ä¼ æ„Ÿå™¨ç¨‹åºè¿è¡ŒæˆåŠŸï¼
