<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "9095c61445c2bca7245ef9b59a186a11",
  "translation_date": "2025-08-25T00:55:20+00:00",
  "source_file": "3-transport/lessons/3-visualize-location-data/README.md",
  "language_code": "zh"
}
-->
# å¯è§†åŒ–ä½ç½®æ•°æ®

![æœ¬è¯¾çš„æ‰‹ç»˜ç¬”è®°æ¦‚è§ˆ](../../../../translated_images/lesson-13.a259db1485021be7d7c72e90842fbe0ab977529e8684c179b5fb1ea75e92b3ef.zh.jpg)

> æ‰‹ç»˜ç¬”è®°ç”± [Nitya Narasimhan](https://github.com/nitya) æä¾›ã€‚ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹æ›´å¤§ç‰ˆæœ¬ã€‚

è¿™æ®µè§†é¢‘æ¦‚è¿°äº† Azure Maps ä¸ IoT çš„åŠŸèƒ½ï¼Œè¿™æ˜¯æœ¬è¯¾å°†è¦è®²è§£çš„æœåŠ¡ã€‚

[![Azure Maps - Microsoft Azure ä¼ä¸šçº§ä½ç½®å¹³å°](https://img.youtube.com/vi/P5i2GFTtb2s/0.jpg)](https://www.youtube.com/watch?v=P5i2GFTtb2s)

> ğŸ¥ ç‚¹å‡»ä¸Šæ–¹å›¾ç‰‡è§‚çœ‹è§†é¢‘

## è¯¾å‰æµ‹éªŒ

[è¯¾å‰æµ‹éªŒ](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/25)

## ç®€ä»‹

åœ¨ä¸Šä¸€è¯¾ä¸­ï¼Œä½ å­¦ä¹ äº†å¦‚ä½•ä»ä¼ æ„Ÿå™¨è·å– GPS æ•°æ®å¹¶ä½¿ç”¨æ— æœåŠ¡å™¨ä»£ç å°†å…¶ä¿å­˜åˆ°äº‘ç«¯çš„å­˜å‚¨å®¹å™¨ä¸­ã€‚ç°åœ¨ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•åœ¨ Azure åœ°å›¾ä¸Šå¯è§†åŒ–è¿™äº›ç‚¹ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•åœ¨ç½‘é¡µä¸Šåˆ›å»ºåœ°å›¾ï¼Œäº†è§£ GeoJSON æ•°æ®æ ¼å¼ï¼Œå¹¶ä½¿ç”¨å®ƒåœ¨åœ°å›¾ä¸Šç»˜åˆ¶æ‰€æœ‰æ•è·çš„ GPS ç‚¹ã€‚

æœ¬è¯¾å†…å®¹åŒ…æ‹¬ï¼š

* [ä»€ä¹ˆæ˜¯æ•°æ®å¯è§†åŒ–](../../../../../3-transport/lessons/3-visualize-location-data)
* [åœ°å›¾æœåŠ¡](../../../../../3-transport/lessons/3-visualize-location-data)
* [åˆ›å»º Azure Maps èµ„æº](../../../../../3-transport/lessons/3-visualize-location-data)
* [åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºåœ°å›¾](../../../../../3-transport/lessons/3-visualize-location-data)
* [GeoJSON æ ¼å¼](../../../../../3-transport/lessons/3-visualize-location-data)
* [ä½¿ç”¨ GeoJSON åœ¨åœ°å›¾ä¸Šç»˜åˆ¶ GPS æ•°æ®](../../../../../3-transport/lessons/3-visualize-location-data)

> ğŸ’ æœ¬è¯¾å°†æ¶‰åŠå°‘é‡ HTML å’Œ JavaScriptã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºä½¿ç”¨ HTML å’Œ JavaScript è¿›è¡Œç½‘é¡µå¼€å‘çš„å†…å®¹ï¼Œè¯·æŸ¥çœ‹ [Web development for beginners](https://github.com/microsoft/Web-Dev-For-Beginners)ã€‚

## ä»€ä¹ˆæ˜¯æ•°æ®å¯è§†åŒ–

æ•°æ®å¯è§†åŒ–ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯é€šè¿‡è§†è§‰åŒ–çš„æ–¹å¼å±•ç¤ºæ•°æ®ï¼Œä½¿äººç±»æ›´å®¹æ˜“ç†è§£ã€‚å®ƒé€šå¸¸ä¸å›¾è¡¨å’Œå›¾å½¢ç›¸å…³ï¼Œä½†å®é™…ä¸Šæ˜¯ä»»ä½•ä»¥å›¾åƒå½¢å¼è¡¨ç¤ºæ•°æ®çš„æ–¹æ³•ï¼Œå¸®åŠ©äººç±»æ›´å¥½åœ°ç†è§£æ•°æ®å¹¶åšå‡ºå†³ç­–ã€‚

ä¸¾ä¸ªç®€å•çš„ä¾‹å­â€”â€”åœ¨å†œåœºé¡¹ç›®ä¸­ï¼Œä½ æ•è·äº†åœŸå£¤æ¹¿åº¦æ•°æ®ã€‚2021 å¹´ 6 æœˆ 1 æ—¥æ¯å°æ—¶æ•è·çš„åœŸå£¤æ¹¿åº¦æ•°æ®è¡¨å¯èƒ½å¦‚ä¸‹ï¼š

| æ—¥æœŸ             | è¯»æ•°   |
| ---------------- | ------: |
| 01/06/2021 00:00 |     257 |
| 01/06/2021 01:00 |     268 |
| 01/06/2021 02:00 |     295 |
| 01/06/2021 03:00 |     305 |
| 01/06/2021 04:00 |     325 |
| 01/06/2021 05:00 |     359 |
| 01/06/2021 06:00 |     398 |
| 01/06/2021 07:00 |     410 |
| 01/06/2021 08:00 |     429 |
| 01/06/2021 09:00 |     451 |
| 01/06/2021 10:00 |     460 |
| 01/06/2021 11:00 |     452 |
| 01/06/2021 12:00 |     420 |
| 01/06/2021 13:00 |     408 |
| 01/06/2021 14:00 |     431 |
| 01/06/2021 15:00 |     462 |
| 01/06/2021 16:00 |     432 |
| 01/06/2021 17:00 |     402 |
| 01/06/2021 18:00 |     387 |
| 01/06/2021 19:00 |     360 |
| 01/06/2021 20:00 |     358 |
| 01/06/2021 21:00 |     354 |
| 01/06/2021 22:00 |     356 |
| 01/06/2021 23:00 |     362 |

å¯¹äºäººç±»æ¥è¯´ï¼Œç†è§£è¿™äº›æ•°æ®å¯èƒ½å¾ˆå›°éš¾ã€‚è¿™æ˜¯ä¸€å †æ²¡æœ‰æ„ä¹‰çš„æ•°å­—ã€‚ä½œä¸ºå¯è§†åŒ–è¿™äº›æ•°æ®çš„ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥å°†å…¶ç»˜åˆ¶æˆæŠ˜çº¿å›¾ï¼š

![ä¸Šè¿°æ•°æ®çš„æŠ˜çº¿å›¾](../../../../translated_images/chart-soil-moisture.fd6d9d0cdc0b5f75e78038ecb8945dfc84b38851359de99d84b16e3336d6d7c2.zh.png)

è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯ä»¥æ·»åŠ ä¸€æ¡çº¿ï¼Œè¡¨ç¤ºå½“åœŸå£¤æ¹¿åº¦è¯»æ•°è¾¾åˆ° 450 æ—¶è‡ªåŠ¨æµ‡æ°´ç³»ç»Ÿå¯åŠ¨çš„æ—¶é—´ç‚¹ï¼š

![å¸¦æœ‰ 450 çº¿çš„åœŸå£¤æ¹¿åº¦æŠ˜çº¿å›¾](../../../../translated_images/chart-soil-moisture-relay.fbb391236d34a64d0abf1df396e9197e0a24df14150620b9cc820a64a55c9326.zh.png)

è¿™ä¸ªå›¾è¡¨å¯ä»¥å¿«é€Ÿæ˜¾ç¤ºåœŸå£¤æ¹¿åº¦æ°´å¹³ä»¥åŠæµ‡æ°´ç³»ç»Ÿå¯åŠ¨çš„æ—¶é—´ç‚¹ã€‚

å›¾è¡¨å¹¶ä¸æ˜¯å”¯ä¸€çš„å¯è§†åŒ–å·¥å…·ã€‚è¿½è¸ªå¤©æ°”çš„ IoT è®¾å¤‡å¯ä»¥é€šè¿‡ç½‘é¡µåº”ç”¨æˆ–ç§»åŠ¨åº”ç”¨ä½¿ç”¨ç¬¦å·æ¥å¯è§†åŒ–å¤©æ°”çŠ¶å†µï¼Œä¾‹å¦‚ç”¨äº‘æœµç¬¦å·è¡¨ç¤ºé˜´å¤©ï¼Œç”¨é›¨äº‘ç¬¦å·è¡¨ç¤ºé›¨å¤©ç­‰ç­‰ã€‚å¯è§†åŒ–æ•°æ®çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ‰äº›ä¸¥è‚ƒï¼Œæœ‰äº›æœ‰è¶£ã€‚

âœ… æƒ³ä¸€æƒ³ä½ è§è¿‡çš„æ•°æ®å¯è§†åŒ–æ–¹å¼ã€‚å“ªäº›æ–¹å¼æœ€æ¸…æ™°ï¼Œèƒ½è®©ä½ æœ€å¿«åšå‡ºå†³ç­–ï¼Ÿ

æœ€å¥½çš„å¯è§†åŒ–æ–¹å¼èƒ½è®©äººç±»å¿«é€Ÿåšå‡ºå†³ç­–ã€‚ä¾‹å¦‚ï¼Œæ˜¾ç¤ºå·¥ä¸šæœºå™¨å„ç§è¯»æ•°çš„ä»ªè¡¨å¢™å¾ˆéš¾å¤„ç†ï¼Œä½†å½“æŸäº›ä¸œè¥¿å‡ºé—®é¢˜æ—¶ï¼Œä¸€ä¸ªé—ªçƒçš„çº¢ç¯å¯ä»¥è®©äººå¿«é€Ÿåšå‡ºå†³ç­–ã€‚æœ‰æ—¶å€™ï¼Œæœ€å¥½çš„å¯è§†åŒ–æ–¹å¼å°±æ˜¯ä¸€ä¸ªé—ªçƒçš„ç¯ï¼

åœ¨å¤„ç† GPS æ•°æ®æ—¶ï¼Œæœ€æ¸…æ™°çš„å¯è§†åŒ–æ–¹å¼æ˜¯å°†æ•°æ®ç»˜åˆ¶åœ¨åœ°å›¾ä¸Šã€‚ä¾‹å¦‚ï¼Œæ˜¾ç¤ºé€è´§å¡è½¦çš„åœ°å›¾å¯ä»¥å¸®åŠ©åŠ å·¥å‚çš„å·¥ä½œäººå‘˜äº†è§£å¡è½¦çš„åˆ°è¾¾æ—¶é—´ã€‚å¦‚æœè¿™å¼ åœ°å›¾ä¸ä»…æ˜¾ç¤ºå¡è½¦å½“å‰ä½ç½®ï¼Œè¿˜æ˜¾ç¤ºå¡è½¦çš„è´§ç‰©ä¿¡æ¯ï¼Œé‚£ä¹ˆåŠ å·¥å‚çš„å·¥ä½œäººå‘˜å¯ä»¥æå‰è®¡åˆ’â€”â€”å¦‚æœä»–ä»¬çœ‹åˆ°ä¸€è¾†å†·è—å¡è½¦æ¥è¿‘ï¼Œä»–ä»¬å°±çŸ¥é“éœ€è¦å‡†å¤‡å†·è—ç©ºé—´ã€‚

## åœ°å›¾æœåŠ¡

å¤„ç†åœ°å›¾æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç»ƒä¹ ï¼Œæœ‰è®¸å¤šåœ°å›¾æœåŠ¡å¯ä¾›é€‰æ‹©ï¼Œä¾‹å¦‚ Bing Mapsã€Leafletã€Open Street Maps å’Œ Google Mapsã€‚åœ¨æœ¬è¯¾ä¸­ï¼Œä½ å°†å­¦ä¹  [Azure Maps](https://azure.microsoft.com/services/azure-maps/?WT.mc_id=academic-17441-jabenn) ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒæ¥æ˜¾ç¤ºä½ çš„ GPS æ•°æ®ã€‚

![Azure Maps æ ‡å¿—](../../../../translated_images/azure-maps-logo.35d01dcfbd81fe6140e94257aaa1538f785a58c91576d14e0ebe7a2f6c694b99.zh.png)

Azure Maps æ˜¯â€œä¸€ç»„åœ°ç†ç©ºé—´æœåŠ¡å’Œ SDKï¼Œä½¿ç”¨æœ€æ–°çš„åœ°å›¾æ•°æ®ä¸ºç½‘é¡µå’Œç§»åŠ¨åº”ç”¨æä¾›åœ°ç†èƒŒæ™¯ã€‚â€å¼€å‘è€…å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·åˆ›å»ºç¾è§‚ã€äº¤äº’å¼çš„åœ°å›¾ï¼Œè¿™äº›åœ°å›¾å¯ä»¥æä¾›æ¨èçš„äº¤é€šè·¯çº¿ã€äº¤é€šäº‹æ•…ä¿¡æ¯ã€å®¤å†…å¯¼èˆªã€æœç´¢åŠŸèƒ½ã€æµ·æ‹”ä¿¡æ¯ã€å¤©æ°”æœåŠ¡ç­‰ã€‚

âœ… è¯•è¯•ä¸€äº› [åœ°å›¾ä»£ç ç¤ºä¾‹](https://docs.microsoft.com/samples/browse?WT.mc_id=academic-17441-jabenn&products=azure-maps)

ä½ å¯ä»¥å°†åœ°å›¾æ˜¾ç¤ºä¸ºç©ºç™½ç”»å¸ƒã€ç“¦ç‰‡ã€å«æ˜Ÿå›¾åƒã€å¸¦æœ‰é“è·¯å åŠ çš„å«æ˜Ÿå›¾åƒã€å„ç§ç±»å‹çš„ç°åº¦åœ°å›¾ã€å¸¦æœ‰é˜´å½±çš„åœ°å›¾ä»¥æ˜¾ç¤ºæµ·æ‹”ã€å¤œè§†åœ°å›¾ä»¥åŠé«˜å¯¹æ¯”åº¦åœ°å›¾ã€‚é€šè¿‡ä¸ [Azure Event Grid](https://azure.microsoft.com/services/event-grid/?WT.mc_id=academic-17441-jabenn) é›†æˆï¼Œä½ å¯ä»¥åœ¨åœ°å›¾ä¸Šè·å¾—å®æ—¶æ›´æ–°ã€‚ä½ å¯ä»¥é€šè¿‡å¯ç”¨å„ç§æ§ä»¶æ¥æ§åˆ¶åœ°å›¾çš„è¡Œä¸ºå’Œå¤–è§‚ï¼Œä½¿åœ°å›¾å¯¹äº‹ä»¶å¦‚ç¼©æ”¾ã€æ‹–åŠ¨å’Œç‚¹å‡»åšå‡ºååº”ã€‚ä¸ºäº†æ§åˆ¶åœ°å›¾çš„å¤–è§‚ï¼Œä½ å¯ä»¥æ·»åŠ åŒ…æ‹¬æ°”æ³¡ã€çº¿æ¡ã€å¤šè¾¹å½¢ã€çƒ­å›¾ç­‰çš„å›¾å±‚ã€‚é€‰æ‹©å“ªç§åœ°å›¾æ ·å¼å–å†³äºä½ é€‰æ‹©çš„ SDKã€‚

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—® Azure Maps APIï¼š[REST API](https://docs.microsoft.com/javascript/api/azure-maps-rest/?WT.mc_id=academic-17441-jabenn&view=azure-maps-typescript-latest)ã€[Web SDK](https://docs.microsoft.com/azure/azure-maps/how-to-use-map-control?WT.mc_id=academic-17441-jabenn) æˆ–è€…å¦‚æœä½ æ­£åœ¨æ„å»ºç§»åŠ¨åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ [Android SDK](https://docs.microsoft.com/azure/azure-maps/how-to-use-android-map-control-library?WT.mc_id=academic-17441-jabenn&pivots=programming-language-java-android)ã€‚

åœ¨æœ¬è¯¾ä¸­ï¼Œä½ å°†ä½¿ç”¨ Web SDK ç»˜åˆ¶åœ°å›¾å¹¶æ˜¾ç¤ºä¼ æ„Ÿå™¨çš„ GPS ä½ç½®è·¯å¾„ã€‚

## åˆ›å»º Azure Maps èµ„æº

ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ª Azure Maps è´¦æˆ·ã€‚

### ä»»åŠ¡ - åˆ›å»º Azure Maps èµ„æº

1. åœ¨ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨ä½ çš„ `gps-sensor` èµ„æºç»„ä¸­åˆ›å»ºä¸€ä¸ª Azure Maps èµ„æºï¼š

    ```sh
    az maps account create --name gps-sensor \
                           --resource-group gps-sensor \
                           --accept-tos \
                           --sku S1
    ```

    è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º `gps-sensor` çš„ Azure Maps èµ„æºã€‚ä½¿ç”¨çš„å±‚çº§æ˜¯ `S1`ï¼Œè¿™æ˜¯ä¸€ä¸ªä»˜è´¹å±‚çº§ï¼ŒåŒ…å«ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œä½†æä¾›äº†å¤§é‡å…è´¹çš„è°ƒç”¨ã€‚

    > ğŸ’ è¦æŸ¥çœ‹ä½¿ç”¨ Azure Maps çš„è´¹ç”¨ï¼Œè¯·è®¿é—® [Azure Maps å®šä»·é¡µé¢](https://azure.microsoft.com/pricing/details/azure-maps/?WT.mc_id=academic-17441-jabenn)ã€‚

1. ä½ éœ€è¦ä¸€ä¸ªåœ°å›¾èµ„æºçš„ API å¯†é’¥ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–è¯¥å¯†é’¥ï¼š

    ```sh
    az maps account keys list --name gps-sensor \
                              --resource-group gps-sensor \
                              --output table
    ```

    å¤åˆ¶ `PrimaryKey` çš„å€¼ã€‚

## åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºåœ°å›¾

æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºåœ°å›¾ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª `html` æ–‡ä»¶æ¥æ„å»ºä¸€ä¸ªå°å‹ç½‘é¡µåº”ç”¨ï¼›è¯·æ³¨æ„ï¼Œåœ¨ç”Ÿäº§æˆ–å›¢é˜Ÿç¯å¢ƒä¸­ï¼Œä½ çš„ç½‘é¡µåº”ç”¨å¯èƒ½ä¼šæœ‰æ›´å¤šçš„ç»„ä»¶ã€‚

### ä»»åŠ¡ - åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºåœ°å›¾

1. åœ¨æœ¬åœ°è®¡ç®—æœºçš„æŸä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º index.html çš„æ–‡ä»¶ã€‚æ·»åŠ  HTML æ ‡è®°ä»¥å®¹çº³åœ°å›¾ï¼š

    ```html
    <html>
    <head>
        <style>
            #myMap {
                width:100%;
                height:100%;
            }
        </style>
    </head>
    
    <body onload="init()">
        <div id="myMap"></div>
    </body>
    </html>
    ```

    åœ°å›¾å°†åŠ è½½åˆ° `myMap` çš„ `div` ä¸­ã€‚ä¸€äº›æ ·å¼å…è®¸å®ƒå æ®é¡µé¢çš„å®½åº¦å’Œé«˜åº¦ã€‚

    > ğŸ“ `div` æ˜¯ç½‘é¡µä¸­çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œå¯ä»¥å‘½åå’Œè®¾ç½®æ ·å¼ã€‚

1. åœ¨æ‰“å¼€çš„ `<head>` æ ‡ç­¾ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªå¤–éƒ¨æ ·å¼è¡¨æ¥æ§åˆ¶åœ°å›¾æ˜¾ç¤ºï¼Œä»¥åŠä¸€ä¸ªæ¥è‡ª Web SDK çš„å¤–éƒ¨è„šæœ¬æ¥ç®¡ç†åœ°å›¾è¡Œä¸ºï¼š

    ```html
    <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" type="text/css" />
    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>
    ```

    è¿™ä¸ªæ ·å¼è¡¨åŒ…å«åœ°å›¾å¤–è§‚çš„è®¾ç½®ï¼Œè€Œè„šæœ¬æ–‡ä»¶åŒ…å«åŠ è½½åœ°å›¾çš„ä»£ç ã€‚æ·»åŠ è¿™äº›ä»£ç ç±»ä¼¼äºåŒ…å« C++ å¤´æ–‡ä»¶æˆ–å¯¼å…¥ Python æ¨¡å—ã€‚

1. åœ¨è¯¥è„šæœ¬ä¸‹æ–¹ï¼Œæ·»åŠ ä¸€ä¸ªè„šæœ¬å—ä»¥å¯åŠ¨åœ°å›¾ã€‚

    ```javascript
    <script type='text/javascript'>
        function init() {
            var map = new atlas.Map('myMap', {
                center: [-122.26473, 47.73444],
                zoom: 12,
                authOptions: {
                    authType: "subscriptionKey",
                    subscriptionKey: "<subscription_key>",

                }
            });
        }
    </script>
    ```

    å°† `<subscription_key>` æ›¿æ¢ä¸ºä½ çš„ Azure Maps è´¦æˆ·çš„ API å¯†é’¥ã€‚

    å¦‚æœä½ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä½ çš„ `index.html` é¡µé¢ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªåœ°å›¾åŠ è½½å¹¶èšç„¦åœ¨è¥¿é›…å›¾åœ°åŒºã€‚

    ![æ˜¾ç¤ºè¥¿é›…å›¾çš„åœ°å›¾ï¼Œè¥¿é›…å›¾æ˜¯ç¾å›½åç››é¡¿å·çš„ä¸€ä¸ªåŸå¸‚](../../../../translated_images/map-image.8fb2c53eb23ef39c1c0a4410a5282e879b3b452b707eb066ff04c5488d3d72b7.zh.png)

    âœ… å°è¯•è°ƒæ•´ç¼©æ”¾å’Œä¸­å¿ƒå‚æ•°ä»¥æ›´æ”¹åœ°å›¾æ˜¾ç¤ºã€‚ä½ å¯ä»¥æ·»åŠ ä¸ä½ æ•°æ®çš„çº¬åº¦å’Œç»åº¦å¯¹åº”çš„ä¸åŒåæ ‡æ¥é‡æ–°å®šä½åœ°å›¾ã€‚

> ğŸ’ åœ¨æœ¬åœ°è¿è¡Œç½‘é¡µåº”ç”¨çš„æ›´å¥½æ–¹æ³•æ˜¯å®‰è£… [http-server](https://www.npmjs.com/package/http-server)ã€‚ä½ éœ€è¦å…ˆå®‰è£… [node.js](https://nodejs.org/) å’Œ [npm](https://www.npmjs.com/)ã€‚å®‰è£…è¿™äº›å·¥å…·åï¼Œä½ å¯ä»¥å¯¼èˆªåˆ° `index.html` æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®å¹¶è¾“å…¥ `http-server`ã€‚ç½‘é¡µåº”ç”¨å°†ä¼šåœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šæ‰“å¼€ [http://127.0.0.1:8080/](http://127.0.0.1:8080/)ã€‚

## GeoJSON æ ¼å¼

ç°åœ¨ä½ å·²ç»è®¾ç½®äº†ç½‘é¡µåº”ç”¨å¹¶æ˜¾ç¤ºäº†åœ°å›¾ï¼Œæ¥ä¸‹æ¥éœ€è¦ä»å­˜å‚¨è´¦æˆ·ä¸­æå– GPS æ•°æ®ï¼Œå¹¶åœ¨åœ°å›¾ä¸Šæ·»åŠ æ ‡è®°å±‚æ˜¾ç¤ºè¿™äº›æ•°æ®ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ Azure Maps æ‰€éœ€çš„ [GeoJSON](https://wikipedia.org/wiki/GeoJSON) æ ¼å¼ã€‚

[GeoJSON](https://geojson.org/) æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†çš„ JSON è§„èŒƒï¼Œå…·æœ‰ä¸“é—¨çš„æ ¼å¼è®¾è®¡ï¼Œç”¨äºå¤„ç†åœ°ç†ç›¸å…³æ•°æ®ã€‚ä½ å¯ä»¥é€šè¿‡æµ‹è¯•ç¤ºä¾‹æ•°æ®æ¥äº†è§£å®ƒï¼Œä¾‹å¦‚ä½¿ç”¨ [geojson.io](https://geojson.io)ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªè°ƒè¯• GeoJSON æ–‡ä»¶çš„æœ‰ç”¨å·¥å…·ã€‚

ç¤ºä¾‹ GeoJSON æ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼š

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -2.10237979888916,
          57.164918677004714
        ]
      }
    }
  ]
}
```

ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯æ•°æ®å¦‚ä½•åµŒå¥—ä¸º `Feature`ï¼Œå¹¶åŒ…å«åœ¨ `FeatureCollection` ä¸­ã€‚åœ¨è¯¥å¯¹è±¡ä¸­å¯ä»¥æ‰¾åˆ° `geometry`ï¼Œå…¶ä¸­ `coordinates` æŒ‡ç¤ºçº¬åº¦å’Œç»åº¦ã€‚

âœ… åœ¨æ„å»ºä½ çš„ GeoJSON æ—¶ï¼Œè¯·æ³¨æ„å¯¹è±¡ä¸­ `latitude` å’Œ `longitude` çš„é¡ºåºï¼Œå¦åˆ™ä½ çš„ç‚¹å¯èƒ½ä¸ä¼šå‡ºç°åœ¨æ­£ç¡®çš„ä½ç½®ï¼GeoJSON æœŸæœ›ç‚¹æ•°æ®çš„é¡ºåºä¸º `lon,lat`ï¼Œè€Œä¸æ˜¯ `lat,lon`ã€‚

`Geometry` å¯ä»¥æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚å•ç‚¹æˆ–å¤šè¾¹å½¢ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‚¹ï¼ŒæŒ‡å®šäº†ä¸¤ä¸ªåæ ‡ï¼šç»åº¦å’Œçº¬åº¦ã€‚
âœ… Azure Maps æ”¯æŒæ ‡å‡† GeoJSONï¼Œå¹¶æä¾›ä¸€äº›[å¢å¼ºåŠŸèƒ½](https://docs.microsoft.com/azure/azure-maps/extend-geojson?WT.mc_id=academic-17441-jabenn)ï¼ŒåŒ…æ‹¬ç»˜åˆ¶åœ†å½¢å’Œå…¶ä»–å‡ ä½•å›¾å½¢çš„èƒ½åŠ›ã€‚

## ä½¿ç”¨ GeoJSON åœ¨åœ°å›¾ä¸Šç»˜åˆ¶ GPS æ•°æ®

ç°åœ¨ï¼Œæ‚¨å·²ç»å‡†å¤‡å¥½ä½¿ç”¨ä¸Šä¸€è¯¾ä¸­æ„å»ºçš„å­˜å‚¨ä¸­çš„æ•°æ®ã€‚æé†’ä¸€ä¸‹ï¼Œè¿™äº›æ•°æ®å­˜å‚¨ä¸º Blob å­˜å‚¨ä¸­çš„å¤šä¸ªæ–‡ä»¶ï¼Œå› æ­¤æ‚¨éœ€è¦æ£€ç´¢è¿™äº›æ–‡ä»¶å¹¶è§£æå®ƒä»¬ï¼Œä»¥ä¾¿ Azure Maps å¯ä»¥ä½¿ç”¨è¿™äº›æ•°æ®ã€‚

### ä»»åŠ¡ - é…ç½®å­˜å‚¨ä»¥ä¾¿ä»ç½‘é¡µè®¿é—®

å¦‚æœæ‚¨è°ƒç”¨å­˜å‚¨ä»¥è·å–æ•°æ®ï¼Œå¯èƒ½ä¼šæƒŠè®¶åœ°å‘ç°æµè§ˆå™¨æ§åˆ¶å°ä¸­å‡ºç°é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºæ‚¨éœ€è¦ä¸ºæ­¤å­˜å‚¨è®¾ç½® [CORS](https://developer.mozilla.org/docs/Web/HTTP/CORS) æƒé™ï¼Œä»¥å…è®¸å¤–éƒ¨ç½‘é¡µåº”ç”¨è¯»å–å…¶æ•°æ®ã€‚

> ğŸ“ CORS ä»£è¡¨â€œè·¨åŸŸèµ„æºå…±äº«â€ï¼Œé€šå¸¸éœ€è¦åœ¨ Azure ä¸­æ˜¾å¼è®¾ç½®ä»¥ç¡®ä¿å®‰å…¨æ€§ã€‚å®ƒå¯ä»¥é˜»æ­¢æ‚¨ä¸æœŸæœ›çš„ç½‘ç«™è®¿é—®æ‚¨çš„æ•°æ®ã€‚

1. è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¯ç”¨ CORSï¼š

    ```sh
    az storage cors add --methods GET \
                        --origins "*" \
                        --services b \
                        --account-name <storage_name> \
                        --account-key <key1>
    ```

    å°† `<storage_name>` æ›¿æ¢ä¸ºæ‚¨çš„å­˜å‚¨è´¦æˆ·åç§°ã€‚å°† `<key1>` æ›¿æ¢ä¸ºæ‚¨çš„å­˜å‚¨è´¦æˆ·çš„è´¦æˆ·å¯†é’¥ã€‚

    æ­¤å‘½ä»¤å…è®¸ä»»ä½•ç½‘ç«™ï¼ˆé€šé…ç¬¦ `*` è¡¨ç¤ºä»»ä½•ç½‘ç«™ï¼‰å‘æ‚¨çš„å­˜å‚¨è´¦æˆ·å‘å‡º *GET* è¯·æ±‚ï¼Œå³è·å–æ•°æ®ã€‚`--services b` è¡¨ç¤ºä»…å¯¹ Blob åº”ç”¨æ­¤è®¾ç½®ã€‚

### ä»»åŠ¡ - ä»å­˜å‚¨åŠ è½½ GPS æ•°æ®

1. å°† `init` å‡½æ•°çš„å…¨éƒ¨å†…å®¹æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

    ```javascript
    fetch("https://<storage_name>.blob.core.windows.net/gps-data/?restype=container&comp=list")
        .then(response => response.text())
        .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
        .then(xml => {
            let blobList = Array.from(xml.querySelectorAll("Url"));
                blobList.forEach(async blobUrl => {
                    loadJSON(blobUrl.innerHTML)                
        });
    })
    .then( response => {
        map = new atlas.Map('myMap', {
            center: [-122.26473, 47.73444],
            zoom: 14,
            authOptions: {
                authType: "subscriptionKey",
                subscriptionKey: "<subscription_key>",
    
            }
        });
        map.events.add('ready', function () {
            var source = new atlas.source.DataSource();
            map.sources.add(source);
            map.layers.add(new atlas.layer.BubbleLayer(source));
            source.add(features);
        })
    })
    ```

    å°† `<storage_name>` æ›¿æ¢ä¸ºæ‚¨çš„å­˜å‚¨è´¦æˆ·åç§°ã€‚å°† `<subscription_key>` æ›¿æ¢ä¸ºæ‚¨çš„ Azure Maps è´¦æˆ·çš„ API å¯†é’¥ã€‚

    è¿™é‡Œå‘ç”Ÿäº†å‡ ä»¶äº‹ã€‚é¦–å…ˆï¼Œä»£ç é€šè¿‡ä½¿ç”¨æ‚¨çš„å­˜å‚¨è´¦æˆ·åç§°æ„å»ºçš„ URL ç«¯ç‚¹ä» Blob å®¹å™¨ä¸­è·å–æ‚¨çš„ GPS æ•°æ®ã€‚æ­¤ URL ä» `gps-data` ä¸­æ£€ç´¢ï¼Œè¡¨æ˜èµ„æºç±»å‹æ˜¯å®¹å™¨ï¼ˆ`restype=container`ï¼‰ï¼Œå¹¶åˆ—å‡ºæ‰€æœ‰ Blob çš„ä¿¡æ¯ã€‚æ­¤åˆ—è¡¨ä¸ä¼šè¿”å› Blob æœ¬èº«ï¼Œä½†ä¼šè¿”å›æ¯ä¸ª Blob çš„ URLï¼Œå¯ç”¨äºåŠ è½½ Blob æ•°æ®ã€‚

    > ğŸ’ æ‚¨å¯ä»¥å°†æ­¤ URL æ”¾å…¥æµè§ˆå™¨ä¸­æŸ¥çœ‹å®¹å™¨ä¸­æ‰€æœ‰ Blob çš„è¯¦ç»†ä¿¡æ¯ã€‚æ¯ä¸ªé¡¹ç›®éƒ½ä¼šæœ‰ä¸€ä¸ª `Url` å±æ€§ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­åŠ è½½ä»¥æŸ¥çœ‹ Blob çš„å†…å®¹ã€‚

    ç„¶åï¼Œæ­¤ä»£ç åŠ è½½æ¯ä¸ª Blobï¼Œè°ƒç”¨ä¸€ä¸ª `loadJSON` å‡½æ•°ï¼ˆå°†åœ¨ä¸‹ä¸€æ­¥ä¸­åˆ›å»ºï¼‰ã€‚æ¥ç€ï¼Œå®ƒåˆ›å»ºåœ°å›¾æ§ä»¶ï¼Œå¹¶å‘ `ready` äº‹ä»¶æ·»åŠ ä»£ç ã€‚æ­¤äº‹ä»¶åœ¨åœ°å›¾æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šæ—¶è¢«è°ƒç”¨ã€‚

    `ready` äº‹ä»¶åˆ›å»ºäº†ä¸€ä¸ª Azure Maps æ•°æ®æºâ€”â€”ä¸€ä¸ªåŒ…å« GeoJSON æ•°æ®çš„å®¹å™¨ï¼Œç¨åå°†å¡«å……æ­¤æ•°æ®æºã€‚ç„¶åä½¿ç”¨æ­¤æ•°æ®æºåˆ›å»ºä¸€ä¸ªæ°”æ³¡å›¾å±‚â€”â€”å³åœ°å›¾ä¸Šçš„ä¸€ç»„åœ†å½¢ï¼Œä¸­å¿ƒç‚¹ä½äº GeoJSON ä¸­çš„æ¯ä¸ªç‚¹ã€‚

1. åœ¨ `init` å‡½æ•°ä¸‹æ–¹çš„è„šæœ¬å—ä¸­æ·»åŠ  `loadJSON` å‡½æ•°ï¼š

    ```javascript
    var map, features;

    function loadJSON(file) {
        var xhr = new XMLHttpRequest();
        features = [];
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    gps = JSON.parse(xhr.responseText)
                    features.push(
                        new atlas.data.Feature(new atlas.data.Point([parseFloat(gps.gps.lon), parseFloat(gps.gps.lat)]))
                    )
                }
            }
        };
        xhr.open("GET", file, true);
        xhr.send();
    }    
    ```

    æ­¤å‡½æ•°ç”± fetch ä¾‹ç¨‹è°ƒç”¨ï¼Œç”¨äºè§£æ JSON æ•°æ®å¹¶å°†å…¶è½¬æ¢ä¸ºç»åº¦å’Œçº¬åº¦åæ ‡ä½œä¸º GeoJSON è¯»å–ã€‚
    è§£æå®Œæˆåï¼Œæ•°æ®è¢«è®¾ç½®ä¸º GeoJSON çš„ä¸€ä¸ª `Feature`ã€‚åœ°å›¾å°†è¢«åˆå§‹åŒ–ï¼Œå¹¶ä¸”å°æ°”æ³¡ä¼šå‡ºç°åœ¨æ•°æ®è·¯å¾„å‘¨å›´ï¼š

1. åœ¨æµè§ˆå™¨ä¸­åŠ è½½ HTML é¡µé¢ã€‚é¡µé¢å°†åŠ è½½åœ°å›¾ï¼Œç„¶åä»å­˜å‚¨ä¸­åŠ è½½æ‰€æœ‰ GPS æ•°æ®å¹¶å°†å…¶ç»˜åˆ¶åœ¨åœ°å›¾ä¸Šã€‚

    ![è¥¿é›…å›¾é™„è¿‘åœ£çˆ±å¾·åå·ç«‹å…¬å›­çš„åœ°å›¾ï¼Œæ˜¾ç¤ºå…¬å›­è¾¹ç¼˜è·¯å¾„ä¸Šçš„åœ†å½¢æ ‡è®°](../../../../translated_images/map-path.896832e72dc696ffe20650e4051027d4855442d955f93fdbb80bb417ca8a406f.zh.png)

> ğŸ’ æ‚¨å¯ä»¥åœ¨ [code](../../../../../3-transport/lessons/3-visualize-location-data/code) æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°æ­¤ä»£ç ã€‚

---

## ğŸš€ æŒ‘æˆ˜

åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºé™æ€æ•°æ®ä½œä¸ºæ ‡è®°æ˜¯å¾ˆä¸é”™çš„ã€‚æ‚¨èƒ½å¦å¢å¼ºæ­¤ç½‘é¡µåº”ç”¨ï¼Œæ·»åŠ åŠ¨ç”»å¹¶æ˜¾ç¤ºæ ‡è®°éšæ—¶é—´å˜åŒ–çš„è·¯å¾„ï¼Œä½¿ç”¨å¸¦æ—¶é—´æˆ³çš„ JSON æ–‡ä»¶ï¼Ÿä»¥ä¸‹æ˜¯ä¸€äº›[ä½¿ç”¨åœ°å›¾åŠ¨ç”»çš„ç¤ºä¾‹](https://azuremapscodesamples.azurewebsites.net/)ã€‚

## è¯¾åæµ‹éªŒ

[è¯¾åæµ‹éªŒ](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/26)

## å¤ä¹ ä¸è‡ªå­¦

Azure Maps åœ¨å¤„ç† IoT è®¾å¤‡æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚

* åœ¨ [Microsoft Docs ä¸Šçš„ Azure Maps æ–‡æ¡£](https://docs.microsoft.com/azure/azure-maps/tutorial-iot-hub-maps?WT.mc_id=academic-17441-jabenn)ä¸­ç ”ç©¶ä¸€äº›ä½¿ç”¨æ¡ˆä¾‹ã€‚
* é€šè¿‡ [Microsoft Learn ä¸Šçš„ Azure Maps è‡ªå­¦æ¨¡å—](https://docs.microsoft.com/learn/modules/create-your-first-app-with-azure-maps/?WT.mc_id=academic-17441-jabenn)åŠ æ·±æ‚¨å¯¹åœ°å›¾åˆ¶ä½œå’Œèˆªç‚¹çš„äº†è§£ã€‚

## ä½œä¸š

[éƒ¨ç½²æ‚¨çš„åº”ç”¨](assignment.md)
